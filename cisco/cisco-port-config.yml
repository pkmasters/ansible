---
- name: 1 Interactive Playbook - Select Host
  hosts: localhost
  gather_facts: false
  vars_prompt:
    - name: target_switch
      prompt: Enter the hostname (ansible inv hostname)
      private: false

  tasks:
    - name: Add the selected switch to a new group
      add_host:
        name: "{{  target_switch }}"
        groups: dynamic_switch

    - name: Display the hostname of the selected switch
      ansible.builtin.debug:
        msg: "SWITCH HOSTNAME: {{ target_switch }}"

- name: 2 Interactive Playbook - Cisco IOS/IOS XE Port Configurator
  hosts: dynamic_switch
  gather_facts: false
  vars_prompt:

    - name: access_port_selection
      prompt: Enter the interface(s) you would like to configure as an access port (eg. Gi0/1,Gi1/0/1,Eth1/1)
      private: false

    - name: vlan_access_port_selection
      prompt: Enter the VLAN would like to access those interface(s) (eg. 10,20)
      private: false

    - name: device_type
      prompt: "If configuring VLAN 120, specify device type (workstation/phone) - press enter if not VLAN 120"
      private: false

    - name: trunk_port_selection
      prompt: Enter the interface(s) you would like to configure as a trunk port (eg. Gi0/1,Gi1/0/1,Eth1/1)
      private: false

    - name: vlan_trunk_port_selection
      prompt: Enter the VLAN(s) you would like to trunk over those interface(s) (eg. 10,20)
      private: false
    
    - name: native_trunk_port_selection
      prompt: Enter the Native VLAN for the Trunk(s) (leave blank if none)
      private: false

    - name: shut_port_selection
      prompt: Enter the interface(s) you would like to shutdown (eg. Gi0/1,Gi1/0/1,Eth1/1)
      private: false

  tasks:
    - name: Configure the Ethernet Access Port(s)
      ios_config:
        lines:
          - interface range {{ access_port_selection }} #selects the range of interfaces
          - switchport mode access #put to access mode
          - switchport access vlan {{ vlan_access_port_selection }} #puts VLANs on the interfaces
          - no shutdown #enables the port
          - desc {{ description }} #sets description based on VLAN
      vars:
        description: >
          {% if vlan_access_port_selection|int == 123 %}
          DeviceX Location
          {% elif vlan_access_port_selection|int in [123,1234] %}
          DeviceY Location
          {% elif vlan_access_port_selection|int == 123 and device_type|lower == 'xx' %}
          DeviceZ Location
          {% elif vlan_access_port_selection|int == 123 and device_type|lower == 'xx' %}
          DeviceA Location
          {% elif vlan_access_port_selection|int == 123 %}
          VLAN XXX Device
          {% else %}
          Access Port
          {% endif %}
      when:
        - access_port_selection is defined
        - access_port_selection != ""
        - access_port_selection != "0"
        - vlan_access_port_selection is defined
        - vlan_access_port_selection != ""
        - vlan_access_port_selection != "0"
    
    - name: Configure the Ethernet Trunk Port(s)
      cisco.ios.ios_config:
        lines:
          - interface range {{ trunk_port_selection }} #selects the range of intefaces
          - switchport mode trunk #put to trunk mode
          - no switchport trunk allowed vlan #clears any prexisting VLAN
          - switchport trunk allowed vlan {{ vlan_trunk_port_selection }} #allows VLANs over the trunk
          - no shutdown #enables the port
          - description Trunk to Location #sets a description
          - switchport noneg #force static trunking
      when:
        - trunk_port_selection is defined
        - trunk_port_selection != ""
        - trunk_port_selection != "0"
        - vlan_trunk_port_selection is defined
        - vlan_trunk_port_selection != ""
        - vlan_trunk_port_selection != "0"

    - name: Configure the Native VLAN on the Trunk(s)
      ios_config:
        lines:
          - interface range {{ trunk_port_selection }} #selects the range of interfaces
          - switchport trunk native vlan {{ native_trunk_port_selection | int }} #assigns the native vlan if there is one
      when:
        - native_trunk_port_selection is defined
        - native_trunk_port_selection != ""
        - native_trunk_port_selection != "0"
        - trunk_port_selection is defined
        - trunk_port_selection =! ""
        - trunk_port_selection =! "0"

    - name: Disable the Remaining Ethernet Port(s)
      ios_config:
        lines:
          - interface range {{ shut_port_selection }} #selects the range of interfaces
          - shutdown #admin disables the port
          - desc OPEN Port #sets the description
      when:
        - shut_port_selection is defined
        - shut_port_selection != ""
        - shut_port_selection != "0"
      
    - name: Pause to view output
      ansible.builtin.pause:
        prompt: "Press Enter"
        echo: no
